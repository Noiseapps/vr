#pragma strict

private var mainCamera : GameObject;
private var carrying : boolean;
private var carriedObject : GameObject;
var distance : double;
var smooth : double;
private var ray : Ray;
private var hit : RaycastHit;
private var p : Pickupable;
//                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              private var throwSpeed : Vector3 = new Vector3(0, 26, 40);

function Start () {
	mainCamera = GameObject.FindWithTag ("MainCamera");
	Debug.Log ("Pick The Object in js !");
}

function Update () {
	if (carrying) {
		carry(carriedObject);
		checkDrop();
		checkThrow();
	} else {
		pickup();
	}
}

function carry (cO : GameObject) {
	cO.transform.position = Vector3.Lerp (cO.transform.position, mainCamera.transform.position +
		                                     mainCamera.transform.forward * distance, Time.deltaTime * smooth);
}

function pickup () {
	if (Input.GetKeyDown (KeyCode.E)) {
		Debug.Log("pickup()");
		var x = Screen.width / 2;;
		var y = Screen.height / 2;	
		ray = mainCamera.camera.ScreenPointToRay(new Vector3(x,y));
		if(Physics.Raycast(ray, hit)) {
			p = hit.collider.GetComponent(Pickupable);
			if(p != null){
				carrying = true;
				carriedObject = p.gameObject;
				p.gameObject.rigidbody.isKinematic = true;
			}
		}
	}
}

function checkDrop () {
	if (Input.GetKeyDown (KeyCode.E)) {
		dropObject();
	}
}

function checkThrow() {
	if(Input.GetKeyDown(KeyCode.T)) {
		throwObject();
	}
}

function dropObject () {
	carrying = false;
	carriedObject.gameObject.rigidbody.isKinematic = false;
	carriedObject = null;
}



function throwObject() {
	Debug.Log("throwObject()");
	Debug.Log("transform.rotation: " + transform.rotation);
	//throwSpeed.y = 1;
	//throwSpeed.z = 5;
	//var force = 10;
	carriedObject.gameObject.rigidbody.isKinematic = false;
	carriedObject.gameObject.rigidbody.AddForce(transform.forward * 500);
	//carriedObject.gameObject.rigidbody.velocity = throwSpeed;
	carrying = false;
	carriedObject = null;
}

